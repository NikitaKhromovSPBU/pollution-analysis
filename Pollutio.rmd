---
title: "Анализ данных pollutio"
output: html_notebook
---
```{r setup, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

library(ggplot2)
library(dplyr)
library(scatterPlotMatrix)
library(corrplot)
library(psych)

getmode <- function(v) {
  uniqv <- unique(v)
  uniqv[which.max(tabulate(match(v, uniqv)))]
}
```
# Загрука данных
```{r}
df <- read.csv("../stat2021_sm/POLLUTIO.STD/POLLUTIO.txt", sep="\t", dec=",")
df |> head(5)
```
16 признаков, 60 наблюдений.

## Описание признаков:
1. ***PREC*** - Среднегодовое количество осадков в дюймах - количественный, дискретный (5 значений равны моде)
2. ***JANT*** - Средняя температура января в градусах по фаренгейту - количественный дискретный (5 значений равны моде)
3. ***JULT*** - То же для Июля - количественный дискретный (11 значений равны моде)
4. ***OVR65*** - Процент населения на 1960 г. в возрасте 65 лет и старше - количественный непрерывный
5. ***POPN*** - Средний размер домохозяйства (среднее количество людей на домохозяйство) - количественный непрерывный
6. ***EDUC*** - Средняя продолжительность обучения в школе для лиц старше 22 лет в годах - количественный непрерывный
7. ***HOUS*** - Процент жилья, отвечающего требованиям безопасности и имеющего все удобства - количественный непрерывный
8. ***DENS*** - Численность населения на квадратную милю в урбанизированных районах на 1960 г. - количественный непрерывный
9. ***NONW*** - Процент небелого населения в урбанизированных районах на 1960 г. - количественный непрерывный
10. ***WWDRK*** - Процент людей занятых в профессиях "белых воротничков" - количественный непрерывный
11. ***POOR*** - Процент семей с доходом меньше $3000 - количественный непрерывный
12. ***HC*** - Относительный потенциал загрязнения углеводородами - количественный дискретный (5 значений равны моде)
13. ***NOX*** - То же для оксидов азота - количественный дискретный (7 значений равны моде)
14. ***SO2*** - То же для диоксида серы - количественный дискретный (6 значений равны моде)
15. ***HUMID*** - Среднегодовая относительная влажность воздуха в 1PM в процентах - количественный дискретный (11 значений равны моде)
16. ***MORT*** - Общий показатель смертности с поправкой на возраст на 100 000 человек - количественный непрерывный

## Matrix-Scatterplot
```{r}
df |>
  scatterPlotMatrix(corrPlotType = "Text",
                    plotProperties = list(noCatColor = "Indigo"),
                    slidersPosition = list(dimCount = 6, xStartingDimIndex = 1, yStartingDimIndex = 1),
                    controlWidgets = TRUE, height = 1050, width = 1000)
```

## Статистическая сводка
```{r}
describe(df, type = 1, check = FALSE, range = FALSE) |> as.data.frame() |> mutate(vars = NULL)
```

## Переход к логарифму
Логарифмируемые переменные:

1. ***DENS***
2. ***NONW***
3. ***POOR***
4. ***HC***
5. ***NOX***
6. ***SO2***

Были выбраны именно эти признаки так как по виду их гистограмм можно сказать, что их распределения "скошены" вправо, и у
них подозрительно большие коэффициенты асимметрии и эксцесса.
```{r}
df.log <- df |> mutate(DENS = log(DENS), NONW = log(NONW), POOR = log(POOR), HC = log(HC), NOX = log(NOX), SO2 = log(SO2))
df.log |>
  scatterPlotMatrix(corrPlotType = "Text",
                    plotProperties = list(noCatColor = "Indigo"),
                    slidersPosition = list(dimCount = 6, xStartingDimIndex = 1, yStartingDimIndex = 1),
                    controlWidgets = TRUE, height = 1050, width = 1000)
```
## Статистическая сводка для логарифмированных данных
```{r}
describe(df.log, type = 1, check = FALSE, range = FALSE) |> as.data.frame() |> mutate(vars = NULL)
```

Видно, что гистограммы прологарифмированных признаков стали чуть больше похожи на плотность нормального распределения, и
их коэффициенты асимметрии и эксцесса стали ближе к 0.

## Выявление и удаление выбросов
На графиках зависимостей параметров загрязнения (***HC, NOX, SO2***) и влажности (***HUMID***) можно увидеть отклонения от закономерностей.
Например на графике зависимости ***SO2*** от ***NOX*** выделяются точки справа от "облака" и под ним, а на графике ***HUMID*** от ***NOX***
выделяются точки над и под "облаком".

Точки, в которых логарифм ***SO2*** равен 0, было решено оставить, так как этих точек много, и они являются выбросами только
относительно признака ***SO2***, который, возможно, будет убран из дальнейшего анализа (за счёт сильной корреляции с другими параметрами загрязнения).

Также за выброс можно считать точку с максимальной январской температурой (***JANT***), так как на графиках зависимости этого признака
от признаков ***OVR65*** и ***POPN*** эта точка не выглядит как часть закономерности.
Однако, из-за сильной корреляции признаков ***JULT*** и ***JANT*** последний, возможно, будет убран из будущего анализа, а эта точка
подчиняется остальным закономерностям, поэтому её тоже решено было оставить.

### Графики после удаления выбросов:
```{r}
pollution.outliers <- c(29, 47, 48, 49)
humidity.outliers <- c(18, 29, 41, 48, 49, 50)
so2.zero.outliers <- c(25, 32, 37, 56)
jant.outliers <- c(32)

outliers <- union(pollution.outliers, humidity.outliers)
df.clean <- df.log[-outliers,]
df.clean |>
  scatterPlotMatrix(corrPlotType = "Text",
                    plotProperties = list(noCatColor = "Indigo"),
                    slidersPosition = list(dimCount = 6, xStartingDimIndex = 1, yStartingDimIndex = 1),
                    controlWidgets = TRUE, height = 1050, width = 1000)
```

## Статистическая сводка после удаления выбросов:
```{r}
describe(df.clean, type = 1, check = FALSE, range = FALSE) |> as.data.frame() |> mutate(vars = NULL)
```